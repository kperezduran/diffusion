<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="diffusion_report_picking" inherit_id="stock.report_delivery_document">
        <!-- Add a barcode header after the product column -->
        <xpath expr="//th[@name='th_sm_product']" position="before">
            <th name="th_sm_product_editeur">
                <strong>Éditeur</strong>
            </th>
            <th name="td_sm_product_barcode">
                <strong>Code-barre</strong>
            </th>
            <th name="td_sm_product_barcode">
                <strong>Prix</strong>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sml_product']" position="before">
            <th name="th_sm_product_editeur">
                <strong>Éditeur</strong>
            </th>
            <th name="td_sm_product_barcode">
                <strong>Code-barre</strong>
            </th>
            <th name="td_sm_product_barcode">
                <strong>Prix</strong>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sb_product']" position="before">
            <th name="th_sm_product_editeur">
                <strong>Éditeur</strong>
            </th>
            <th name="td_sm_product_barcode">
                <strong>Code-barre</strong>
            </th>
            <th name="td_sm_product_barcode">
                <strong>Prix</strong>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sm_product']" position="after">
            <th name="th_sm_product_editeur">
                <strong>Auteur(s)</strong>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sml_product']" position="after">
            <th name="th_sm_product_editeur">
                <strong>Auteur(s)</strong>
            </th>
        </xpath>
        <xpath expr="//th[@name='th_sb_product']" position="after">
            <th name="th_sm_product_editeur">
                <strong>Auteur(s)</strong>
            </th>
        </xpath>

        <!-- Add the barcode image for each product line after the product column -->
        <xpath expr="//td" position="before">
            <td class="td_sm_product_editeur">

                <div t-field="move.product_id.editeur"/>
            </td>
            <td class="td_sm_product_barcode">
                <div>
                    <div t-field="move.product_id.barcode"
                         t-options="{'widget': 'barcode', 'width': 180, 'height': 30, 'img_style': 'width:180px;height:30px;'}"/>
                    <span t-field="move.product_id.product_tmpl_id.default_code"
                          style="margin: auto 0.5rem; text-align:center"/>
                </div>
            </td>
            <td class="td_sm_product_barcode">
                <div>
                    <span t-field="move.product_id.product_tmpl_id.list_price"/>€
                </div>
            </td>
        </xpath>
        <!-- Add the barcode image for each product line after the product column -->
        <xpath expr="//td" position="after">
            <td class="td_sm_product_editeur">

                <div t-field="move.product_id.auteur"/>
            </td>
        </xpath>
        <xpath expr="//table[@name='stock_backorder_table']" position="replace">
            <table class="table table-sm" name="stock_backorder_table" style="table-layout: fixed;">
                <thead>
                    <tr>
                        <th name="th_sb_product">
                            <strong>Éditeur</strong>
                        </th>
                        <th name="td_sm_product_barcode" class="text-center">
                            <strong>Code-barre</strong>
                        </th>
                        <th name="td_sm_product_barcode" class="text-center">
                            <strong>prix</strong>
                        </th>
                        <th name="th_sb_product">
                            <strong>Produit</strong>
                        </th>
                        <th name="th_sb_product">
                            <strong>Auteur</strong>
                        </th>
                        <th name="th_sb_quantity" class="text-center">
                            <strong>Quantité</strong>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach="backorders.mapped('move_ids').filtered(lambda x: x.product_uom_qty)" t-as="bo_line">
                        <td class="td_sm_product_editeur w-auto">

                            <div t-field="bo_line.product_id.editeur"/>
                        </td>
                        <td class="td_sm_product_barcode w-auto">
                            <div t-field="bo_line.product_id.barcode"
                                 t-options="{'widget': 'barcode', 'width': 180, 'height': 30, 'img_style': 'width:180px;height:30px;'}"/>
                            <div style="text-align:center">
                                <span t-out="bo_line.product_id.barcode"/>
                            </div>
                        </td>
                        <td class="td_sm_product_barcode w-auto">
                                <span t-out="bo_line.product_id.product_tmpl_id.list_price"/>€
                        </td>
                        <td class="w-auto">
                            <span t-field="bo_line.product_id">Office Chair</span>
                            <p t-if="bo_line.description_picking != bo_line.product_id.name and bo_line.description_picking != bo_line.product_id.display_name">
                                <span t-field="bo_line.description_picking">Description on transfer</span>
                            </p>
                        </td>

                        <td class="td_sm_product_editeur w-auto">

                            <div t-field="bo_line.product_id.product_tmpl_id.auteur"/>
                        </td>
                        <td class="text-center w-auto">
                            <span t-field="bo_line.product_uom_qty">3.00</span>
                            <span t-field="bo_line.product_uom">units</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </xpath>
    </template>
    <template id="diffusion_stock_report_delivery_has_serial_move_line"
              inherit_id="stock.stock_report_delivery_has_serial_move_line">

        <!-- Add the barcode image for each product line after the product column -->
        <xpath expr="//td" position="before">
            <td class="td_sm_product_editeur">
                <div t-field="move_line.product_id.editeur"/>
            </td>
            <td class="td_sm_product_barcode">
                <div t-field="move_line.product_id.barcode"
                     t-options="{'widget': 'barcode', 'width': 180, 'height': 30, 'img_style': 'width:180px;height:30px;'}"/>
            </td>
            <td class="td_sm_product_barcode">
                <span t-field="move_line.product_id.product_tmpl_id.list_price"/>€
            </td>
        </xpath>
        <xpath expr="//td" position="after">
            <td class="td_sm_product_editeur">
                <div style="text-align:center">
                    <span t-field="move_line.product_id.auteur"/>
                </div>
            </td>
        </xpath>
    </template>
    <template id="diffusion_stock_report_delivery_aggregated_move_lines"
              inherit_id="stock.stock_report_delivery_aggregated_move_lines">

        <!-- Add the barcode image for each product line after the product column -->
        <xpath expr="//td" position="before">
            <td class="td_sm_product_editeur">

                <div t-field="aggregated_lines[line]['product'].editeur"/>
            </td>
            <td class="td_sm_product_barcode">

                <div t-field="aggregated_lines[line]['product'].barcode"
                     t-options="{'widget': 'barcode', 'width': 180, 'height': 30, 'img_style': 'width:180px;height:30px;'}"/>
                <div style="margin-top: 10px; with: 100%; text-align:center">
                    <span t-field="aggregated_lines[line]['product'].barcode"/>
                </div>
            </td>
            <td class="td_sm_product_barcode">
                <span t-field="aggregated_lines[line]['product'].product_tmpl_id.list_price"/>€
            </td>
        </xpath>
        <xpath expr="//td[@name='move_line_aggregated_qty_ordered']" position="before">
            <td class="td_sm_product_editeur">

                <div style="text-align:center">
                    <span t-field="aggregated_lines[line]['product'].auteur"/>
                </div>
            </td>
        </xpath>

    </template>

</odoo>
